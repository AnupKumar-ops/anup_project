def VendorName              = "Cisco"
def Product                 = "WarJar"
def Version                 = "vnf_v1.1"
def ArtifactoryUrl          = "http://jenkins-master:8082/artifactory"
def ArtifactoryCredentials = "jfrog"

pipeline {
    agent any
  
    stages {
        stage('SCM Checkout') {
            steps {
                 git 'https://github.com/AnupKumar-ops/anup_project.git'
            }
        }
        stage('download from artifactory') {
            steps {
               script {
                   def server = Artifactory.newServer url: "${ArtifactoryUrl}", credentialsId: "${ArtifactoryCredentials}"
                   def downloadSpec = """{
                                  "files": [
                                              {
                                                 "pattern": "maven-repo/${VendorName}/${Product}/${Version}/*.war",
                                                  "target": "${WORKSPACE}/"
                                              }
                                           ]
                    }"""
                    server.download spec: downloadSpec
               }
            }
        }    
        
        stage('access app from docker qa slave agent') {
              agent {
                    dockerfile {
                       filename 'Dockerfile.build'
                       additionalBuildArgs  "--build-arg WORKSPACE=${WORKSPACE}/${VendorName}/${Product}/${Version}/webapp.war"
                       args '-p 8081:8080'
                       
                    }
              }
              steps {
                  sh 'curl localhost:8081'
              }    
        }
    }
}       
